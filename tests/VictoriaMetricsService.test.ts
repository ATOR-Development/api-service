import axios from 'axios';
import { VictoriaMetricsService } from '../src/VictoriaMetricsService';

jest.mock('axios');
const mockedAxios = axios as jest.Mocked<typeof axios>;

describe('VictoriaMetricsService', () => {
    it('Total relays query', async () => {
        const vmData = {"status":"success","data":{"resultType":"vector","result":[{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"value":[1712316485,"43"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"value":[1712316485,"26"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"value":[1712316485,"17"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"value":[1712316485,"45"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"value":[1712316485,"16"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"value":[1712316485,"29"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"value":[1712316485,"293"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"value":[1712316485,"41"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"value":[1712316485,"252"]}]},"stats":{"seriesFetched": "9","executionTimeMsec":30}};
        const mockData = {"resultType":"vector","result":[{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"value":[1712316485,"43"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"value":[1712316485,"26"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"value":[1712316485,"17"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"value":[1712316485,"45"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"value":[1712316485,"16"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"value":[1712316485,"29"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"value":[1712316485,"293"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"value":[1712316485,"41"]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"value":[1712316485,"252"]}]};
        mockedAxios.get.mockImplementationOnce(() => Promise.resolve(vmData));

        const vmService = new VictoriaMetricsService('http://localhost:8080');
        const result = await vmService.query('total_relays');

        expect(result).toEqual(mockData);
        expect(axios.get).toHaveBeenCalledWith('http://localhost:8080/api/v1/query', {
            params: { query: 'total_relays' },
        });
    });

    it('Total observed bandwidth query', async () => {
        const vmData = {"status":"success","data":{"resultType":"vector","result":[{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"value":[1712497632,"43138495"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"value":[1712497632,"3738891"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"value":[1712497632,"39399604"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"value":[1712497632,"485678705"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"value":[1712497632,"166756840"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"value":[1712497632,"318921865"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"value":[1712497632,"3275143421"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"value":[1712497632,"160435723"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"value":[1712497632,"3114707698"]}]},"stats":{"seriesFetched": "9","executionTimeMsec":37}};
        const mockData = {"resultType":"vector","result":[{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"value":[1712497632,"43138495"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"value":[1712497632,"3738891"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"value":[1712497632,"39399604"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"value":[1712497632,"485678705"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"value":[1712497632,"166756840"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"value":[1712497632,"318921865"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"value":[1712497632,"3275143421"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"value":[1712497632,"160435723"]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"value":[1712497632,"3114707698"]}]};
        mockedAxios.get.mockImplementationOnce(() => Promise.resolve(vmData));

        const vmService = new VictoriaMetricsService('http://localhost:8080');
        const result = await vmService.query('total_observed_bandwidth');

        expect(result).toEqual(mockData);
        expect(axios.get).toHaveBeenCalledWith('http://localhost:8080/api/v1/query', {
            params: { query: 'total_observed_bandwidth' },
        });
    });

    it('Average bandwidth rate query', async () => {
        const vmData = {"status":"success","data":{"resultType":"vector","result":[{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"value":[1712497728,"508379136"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"value":[1712497728,"9402231.466666667"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"value":[1712497728,"948652875.2941176"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"value":[1712497728,"845177831.02439"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"value":[1712497728,"586758931.692308"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"value":[1712497728,"965158034.2857144"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"value":[1712497728,"824589926.4"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"value":[1712497728,"585891840"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"value":[1712497728,"858689653.0285717"]}]},"stats":{"seriesFetched": "9","executionTimeMsec":18}};
        const mockData = {"resultType":"vector","result":[{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"value":[1712497728,"508379136"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"value":[1712497728,"9402231.466666667"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"value":[1712497728,"948652875.2941176"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"value":[1712497728,"845177831.02439"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"value":[1712497728,"586758931.692308"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"value":[1712497728,"965158034.2857144"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"value":[1712497728,"824589926.4"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"value":[1712497728,"585891840"]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"value":[1712497728,"858689653.0285717"]}]};
        mockedAxios.get.mockImplementationOnce(() => Promise.resolve(vmData));

        const vmService = new VictoriaMetricsService('http://localhost:8080');
        const result = await vmService.query('average_bandwidth_rate');

        expect(result).toEqual(mockData);
        expect(axios.get).toHaveBeenCalledWith('http://localhost:8080/api/v1/query', {
            params: { query: 'average_bandwidth_rate' },
        });
    });

    it('Total relays query range', async () => {
        const vmData = {"status":"success","data":{"resultType":"matrix","result":[{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"values":[[1712316678,"43"],[1712316978,"43"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"values":[[1712316678,"26"],[1712316978,"26"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"values":[[1712316678,"17"],[1712316978,"17"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"values":[[1712316678,"45"],[1712316978,"45"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"values":[[1712316678,"16"],[1712316978,"16"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"values":[[1712316678,"29"],[1712316978,"29"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"values":[[1712316678,"293"],[1712316978,"293"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"values":[[1712316678,"41"],[1712316978,"41"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"values":[[1712316678,"252"],[1712316978,"252"]]}]},"stats":{"seriesFetched": "9","executionTimeMsec":7}};
        const mockData = {"resultType":"matrix","result":[{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"values":[[1712316678,"43"],[1712316978,"43"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"values":[[1712316678,"26"],[1712316978,"26"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"values":[[1712316678,"17"],[1712316978,"17"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"values":[[1712316678,"45"],[1712316978,"45"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"values":[[1712316678,"16"],[1712316978,"16"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"values":[[1712316678,"29"],[1712316978,"29"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"values":[[1712316678,"293"],[1712316978,"293"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"values":[[1712316678,"41"],[1712316978,"41"]]},{"metric":{"__name__":"total_relays","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"values":[[1712316678,"252"],[1712316978,"252"]]}]};
        mockedAxios.get.mockImplementationOnce(() => Promise.resolve(vmData));

        const vmService = new VictoriaMetricsService('http://localhost:8080');
        const result = await vmService.query_range('total_relays', 'start', 'end', 'step');
        expect(result).toEqual(mockData);
        expect(axios.get).toHaveBeenCalledWith('http://localhost:8080/api/v1/query_range', {
            params: { query: 'total_relays', start: 'start', end: 'end', step: 'step' },
        });
    });

    it('Total observed bandwidth query range', async () => {
        const vmData = {"status":"success","data":{"resultType":"matrix","result":[{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"values":[[1712497652,"43138495"],[1712497952,"43138495"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"values":[[1712497652,"3738891"],[1712497952,"3738891"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"values":[[1712497652,"39399604"],[1712497952,"39399604"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"values":[[1712497652,"485678705"],[1712497952,"485678705"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"values":[[1712497652,"166756840"],[1712497952,"166756840"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"values":[[1712497652,"318921865"],[1712497952,"318921865"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"values":[[1712497652,"3275143421"],[1712497952,"3275143421"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"values":[[1712497652,"160435723"],[1712497952,"160435723"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"values":[[1712497652,"3114707698"],[1712497952,"3114707698"]]}]},"stats":{"seriesFetched": "9","executionTimeMsec":5}};
        const mockData = {"resultType":"matrix","result":[{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"values":[[1712497652,"43138495"],[1712497952,"43138495"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"values":[[1712497652,"3738891"],[1712497952,"3738891"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"values":[[1712497652,"39399604"],[1712497952,"39399604"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"values":[[1712497652,"485678705"],[1712497952,"485678705"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"values":[[1712497652,"166756840"],[1712497952,"166756840"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"values":[[1712497652,"318921865"],[1712497952,"318921865"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"values":[[1712497652,"3275143421"],[1712497952,"3275143421"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"values":[[1712497652,"160435723"],[1712497952,"160435723"]]},{"metric":{"__name__":"total_observed_bandwidth","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"values":[[1712497652,"3114707698"],[1712497952,"3114707698"]]}]};
        mockedAxios.get.mockImplementationOnce(() => Promise.resolve(vmData));

        const vmService = new VictoriaMetricsService('http://localhost:8080');
        const result = await vmService.query_range('total_observed_bandwidth', 'start', 'end', 'step');
        expect(result).toEqual(mockData);
        expect(axios.get).toHaveBeenCalledWith('http://localhost:8080/api/v1/query_range', {
            params: { query: 'total_observed_bandwidth', start: 'start', end: 'end', step: 'step' },
        });
    });

    it('Average bandwidth rate query range', async () => {
        const vmData = {"status":"success","data":{"resultType":"matrix","result":[{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"values":[[1712497700,"508379136"],[1712498000,"508379136"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"values":[[1712497700,"9402231.466666667"],[1712498000,"9402231.466666667"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"values":[[1712497700,"948652875.2941176"],[1712498000,"948652875.2941176"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"values":[[1712497700,"845177831.02439"],[1712498000,"845177831.02439"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"values":[[1712497700,"586758931.692308"],[1712498000,"586758931.692308"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"values":[[1712497700,"965158034.2857144"],[1712498000,"965158034.2857144"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"values":[[1712497700,"824589926.4"],[1712498000,"824589926.4"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"values":[[1712497700,"585891840"],[1712498000,"585891840"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"values":[[1712497700,"858689653.0285717"],[1712498000,"858689653.0285717"]]}]},"stats":{"seriesFetched": "9","executionTimeMsec":8}};
        const mockData = {"resultType":"matrix","result":[{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"all"},"values":[[1712497700,"508379136"],[1712498000,"508379136"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"offline"},"values":[[1712497700,"9402231.466666667"],[1712498000,"9402231.466666667"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9090","job":"consulagentonionoo","status":"online"},"values":[[1712497700,"948652875.2941176"],[1712498000,"948652875.2941176"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"all"},"values":[[1712497700,"845177831.02439"],[1712498000,"845177831.02439"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"offline"},"values":[[1712497700,"586758931.692308"],[1712498000,"586758931.692308"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9190","job":"consulagentonionoo","status":"online"},"values":[[1712497700,"965158034.2857144"],[1712498000,"965158034.2857144"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"all"},"values":[[1712497700,"824589926.4"],[1712498000,"824589926.4"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"offline"},"values":[[1712497700,"585891840"],[1712498000,"585891840"]]},{"metric":{"__name__":"average_bandwidth_rate","cluster":"local","env":"main","instance":"10.1.244.1:9290","job":"consulagentonionoo","status":"online"},"values":[[1712497700,"858689653.0285717"],[1712498000,"858689653.0285717"]]}]};
        mockedAxios.get.mockImplementationOnce(() => Promise.resolve(vmData));

        const vmService = new VictoriaMetricsService('http://localhost:8080');
        const result = await vmService.query_range('average_bandwidth_rate', 'start', 'end', 'step');
        expect(result).toEqual(mockData);
        expect(axios.get).toHaveBeenCalledWith('http://localhost:8080/api/v1/query_range', {
            params: { query: 'average_bandwidth_rate', start: 'start', end: 'end', step: 'step' },
        });
    });
});